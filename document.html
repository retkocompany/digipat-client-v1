<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>پرونده بیمار</title>
  <link
          rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
          crossorigin="anonymous"
  />
  <link rel="stylesheet" href="bootstrap.css">
  <link rel="stylesheet" href="content/css/main.css">
  <link rel="stylesheet" href="content/css/document.css">
</head>
<body>
<div class="page-container">

  <!-- Page content -->
  <div class="page-content">
    <!-- Main content -->
    <div class="content-wrapper">
      <!-- Content area -->
      <div class="content">

        <div class="row">
          <div class="col-sm-2 col-lg-2"></div>
          <div class="col-sm-8 col-lg-8">

            <!-- User details (with sample pattern) -->
            <div class="content-group">

<!--              <img src="images/lab2.jpg" alt="" class="img-responsive" width="512" height="256" id="projectimage">-->


              <div class="panel panel-body no-border-top no-border-radius-top">
                <input type="hidden" name="labId" value="" id="labId">
                <div class="form-group mt-5">
                  <label class="text-semibold">عنوان : </label>
                  <span class="pull-right-sm" id="title"></span>
                </div>

                <div class="form-group">
                  <label class="text-semibold">نام آزمایشگاه : </label>
                  <span class="pull-right-sm" id="labName"></span>
                </div>

                <div class="form-group">
                  <label class="text-semibold">نام بیمار : </label>
                  <span class="pull-right-sm" id="patientName"></span>
                </div>

                <div class="form-group">
                  <label class="text-semibold">نام مسئول : </label>
                  <span class="pull-right-sm" id="operatorName"></span>
                </div>

              </div>
            </div>

            <div class="panel panel-flat" id="documents">
              <div class="table-responsive">

                <table class="table datatable-basic">
                  <thead>
                  <tr>
                    <th class="text-center">نوع آیتم</th>
<!--                    <th class="text-center">کاربر سازنده</th>-->
                    <th class="text-center">تاریخ ایجاد</th>
                    <th class="text-center">عملیات</th>
                    <th class="text-center"></th>
                  </tr>
                  </thead>
                  <tbody id="itemsInfo">
<!--                    <tr>-->
<!--                      <td class="text-center"> pathology </td>-->
<!--                      <td class="text-center"> ادمین </td>-->
<!--                      <td class="text-center"> 2021-09-01 03:48:38 </td>-->
<!--                      <td class='text-center'><a href='#' id='item' class='item'><i class='glyphicon glyphicon-plus'></i></a></td>-->
<!--                    </tr>-->
                  </tbody>
                </table>

              </div>

            </div>
            <button id="back" type="button" class="btn btn-info btn-block">
              بازگشت
            </button>
            <!-- /user details (with sample pattern) -->

          </div>
          <div class="col-sm-2 col-lg-2">

          </div>
        </div>
      </div>
      <!-- /content area -->

    </div>
    <!-- /main content -->

  </div>
  <!-- /page content -->

</div>
<!--    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>-->
<script type="text/javascript">
  let $ = require ('jquery')
  const path = require('path')
  const fs = require("fs")
  const {ipcRenderer} = require('electron')
  const db_path = path.join(__dirname, 'wsi.json')
  const config = require('electron-json-config')

  // config.set("server_url", "http://wsi.retko.ir/")

  const url = config.get("server_url") + "api/v1/labs/" + localStorage.labId + "/documents/" + localStorage.docId

  window.onload = function () {
    const settings = {
      "url": url,
      "method": "GET",
      "timeout": 0,
      "headers": {
        "Accept": "application/json",
        "Authorization": "Bearer " + localStorage.token
      },
      "processData": false,
      "mimeType": "multipart/form-data",
      "contentType": false
    };

    $.ajax(settings).done(function (response) {
      let j = JSON.parse(response)
      // console.log(response);
      let table = $("#itemsInfo");
      table.empty();
      for (let i = 0; i < j.data.items.length; i++) {
        table.append(buildRow(j.data.items[i], i));
      }
      $('.show').click(function() {
        itemId = $(this).parent().parent().find(".itemId").val()
        console.log(itemId)
        itemPath = $(this).parent().parent().find(".itemPath").val()
        console.log(itemPath)
        config.set("itemId", itemId)
        console.log(config.get("itemId"))
        config.set("itemPath", itemPath)
        console.log(config.get("itemPath"))
        // console.log("itemPath : " + itemPath)
        // console.log("itemPath : " + config.get("itemPath"))
        // console.log(localStorage.itemId)
        ipcRenderer.send('viewer')
      })
    });
    function buildRow(item, index) {
      return "<tr class='item'><input type='hidden' class='itemId' id='itemId" + index + "' value='" + item.id + "'><input type='hidden' class='itemPath' id='itemPath" + index + "' value='" + item.path + "'>" + buildTypeCol(item.type) + buildDateCol(item.created_at) + buildDetailsCol(index) + "</tr>";
    }
    function buildTypeCol(name) {
      return "<td class='text-center'>" + name + "</td>";
    }
    function buildDateCol(date) {
      return "<td class='text-center'>" + date + "</td>";
    }
    function buildDetailsCol(index) {
      return "<td class='text-center'><a href='#' id='show" + index + "' class='show'><i class='glyphicon glyphicon-eye-open'></i></a></td>";
    }
    $("#back").click(function () {
      ipcRenderer.send('back');
    });
  }
</script>
</body>
</html>
